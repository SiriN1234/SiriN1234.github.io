<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="# This Python 3 environment comes with many helpful analytics libraries installed
# It is defined by the kaggle/python Docker image: https://github.co"/>
    

    <!--Author-->
    
        <meta name="author" content="SiriN"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="2022.03.25 수업내용과 실습2"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="# This Python 3 environment comes with many helpful analytics libraries installed
# It is defined by the kaggle/python Docker image: https://github.co"/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="SiriN&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="https://SiriN1234.github.ioimg/home-bg.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="https://SiriN1234.github.ioimg/home-bg.jpg"/>
    

    <!-- Title -->
    
    <title>2022.03.25 수업내용과 실습2 - SiriN&#39;s Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    

</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Configurable Title</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li>
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-clean-blog">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>2022.03.25 수업내용과 실습2</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by Hanjeongin on
                        
                        
                            2022-03-25
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/Python/">#Python</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># This Python 3 environment comes with many helpful analytics libraries installed</span>
<span class="token comment" spellcheck="true"># It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python</span>
<span class="token comment" spellcheck="true"># For example, here's several helpful packages to load</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np <span class="token comment" spellcheck="true"># linear algebra</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment" spellcheck="true"># data processing, CSV file I/O (e.g. pd.read_csv)</span>

<span class="token comment" spellcheck="true"># Input data files are available in the read-only "../input/" directory</span>
<span class="token comment" spellcheck="true"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span>

<span class="token keyword">import</span> os
<span class="token keyword">for</span> dirname<span class="token punctuation">,</span> _<span class="token punctuation">,</span> filenames <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token string">'/kaggle/input'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> filenames<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using "Save &amp; Run All" </span>
<span class="token comment" spellcheck="true"># You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session</span>
</code></pre>
<p>공통 : 데이터 전처리를 잘 해야 됨</p>
<p>머신러닝 &#x2F; 딥러닝 (결과가 중요한 학문)</p>
<ul>
<li>예측만 잘하면 됨</li>
<li>A 모델, B 모델, C 모델</li>
<li>알고리즘의 갯수 무한정</li>
<li>자동차 기본옵션, 풀옵션</li>
</ul>
<p>통계 (과정이 중요한 학문)</p>
<ul>
<li>가설설정(평균의 차이)</li>
<li>정규분포, 등분산성 가정 중요함</li>
<li>통계해석이 중요함</li>
<li>변수들의 관계</li>
<li>독립변수들끼리의 관계, 독립변수와 종속변수들끼리의 관계</li>
</ul>
<p>Scikit-Learn</p>
<ul>
<li>Python 머신러닝의 핵심 라이브러리</li>
<li>머신러닝 코드를 많이 치자</li>
</ul>
<p>PyCaret</p>
<ul>
<li>AutoML 라이브러리 (옵션)</li>
<li>머신러닝 코드를 매우 덜 친다</li>
</ul>
<h1 id="라이브러리-불러오기"><a href="#라이브러리-불러오기" class="headerlink" title="라이브러리 불러오기"></a>라이브러리 불러오기</h1><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sb
<span class="token keyword">import</span> os

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Version Pandas"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Version Matplotlib"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Version Numpy"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Version Seaborn"</span><span class="token punctuation">,</span> sb<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>

os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'../input/tabular-playground-series-apr-2021/'</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">BASE_DIR <span class="token operator">=</span> <span class="token string">"../input/tabular-playground-series-apr-2021/"</span>

train <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>BASE_DIR <span class="token operator">+</span> <span class="token string">"train.csv"</span><span class="token punctuation">)</span>
test <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>BASE_DIR <span class="token operator">+</span> <span class="token string">"test.csv"</span><span class="token punctuation">)</span>
sample_submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>BASE_DIR <span class="token operator">+</span> <span class="token string">"sample_submission.csv"</span><span class="token punctuation">)</span>

train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> test<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> sample_submission<span class="token punctuation">.</span>shape
</code></pre>
<pre class=" language-python"><code class="language-python">train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">test<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">sample_submission<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>데이터를 합침</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 데이터를 상하로 합침</span>
all_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>train<span class="token punctuation">,</span> test<span class="token punctuation">]</span><span class="token punctuation">)</span>
all_df<span class="token punctuation">.</span>shape
</code></pre>
<ul>
<li>결측치 합치기 &amp; 처리하기 (이 부분이 제일 중요)</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Start</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Before Handling:"</span><span class="token punctuation">,</span> all_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Age</span>
age_dict <span class="token operator">=</span> all_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'Pclass'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Pclass'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>round<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Avg. Mean of Age by Pclass:"</span><span class="token punctuation">,</span> age_dict<span class="token punctuation">)</span>
all_df<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_df<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>all_df<span class="token punctuation">.</span>Pclass<span class="token punctuation">.</span>map<span class="token punctuation">(</span>age_dict<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Cabin</span>
all_df<span class="token punctuation">[</span><span class="token string">"Cabin"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">"No Cabin"</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Values from Cabin: "</span><span class="token punctuation">,</span> all_df<span class="token punctuation">[</span><span class="token string">"Cabin"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
all_df<span class="token punctuation">[</span><span class="token string">'Cabin_Code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Values from Cabin Code: "</span><span class="token punctuation">,</span> all_df<span class="token punctuation">[</span><span class="token string">"Cabin_Code"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Fare</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Avg. Mean:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>all_df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
all_df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>round<span class="token punctuation">(</span>all_df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Embarked</span>
all_df<span class="token punctuation">[</span><span class="token string">"Embarked"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">"X"</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Values from Embarked: "</span><span class="token punctuation">,</span> all_df<span class="token punctuation">[</span><span class="token string">"Embarked"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Delete Columns</span>
all_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Ticket'</span><span class="token punctuation">,</span> <span class="token string">'Cabin'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'PassengerId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"After Handling:"</span><span class="token punctuation">,</span> all_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre>
<ul>
<li>피처 인코딩 : 문자열을 숫자로 바꾼다</li>
<li>Feature Encoding<ul>
<li>목적 : 머신러닝 자체가 수식이니까, 문자를 받아들이지 않음. 문자를 수식으로 바꿔야 함.</li>
<li>Ordinal Encoding, Label Encoding, One-Hot Encoding</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">cat_cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Sex'</span><span class="token punctuation">,</span> <span class="token string">'Cabin_Code'</span><span class="token punctuation">,</span> <span class="token string">'Embarked'</span><span class="token punctuation">]</span>
num_cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'SibSp'</span><span class="token punctuation">,</span> <span class="token string">'Parch'</span><span class="token punctuation">,</span> <span class="token string">'Fare'</span><span class="token punctuation">,</span> <span class="token string">'Survived'</span><span class="token punctuation">]</span>

onehot_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>all_df<span class="token punctuation">[</span>cat_cols<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"onehot_df Shape:"</span><span class="token punctuation">,</span> onehot_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

num_df <span class="token operator">=</span> all_df<span class="token punctuation">[</span>num_cols<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"num_df Shape:"</span><span class="token punctuation">,</span> num_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

all_cleansed_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>num_df<span class="token punctuation">,</span> onehot_df<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"all_cleansed_df Shape:"</span><span class="token punctuation">,</span> all_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">all_cleansed_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="머신러닝"><a href="#머신러닝" class="headerlink" title="머신러닝"></a>머신러닝</h1><ul>
<li>데이터 셋 분리<ul>
<li>x는 독립변수</li>
<li>y는 종속변수</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">X <span class="token operator">=</span> all_cleansed_df<span class="token punctuation">[</span><span class="token punctuation">:</span>train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"X Shape is:"</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
y <span class="token operator">=</span> X<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span>
X<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> all_cleansed_df<span class="token punctuation">[</span>train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_data<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape
</code></pre>
<ul>
<li>라이브러리 설치</li>
</ul>
<pre class=" language-python"><code class="language-python">!pip install scikit<span class="token operator">-</span>learn<span class="token operator">==</span><span class="token number">0.23</span><span class="token punctuation">.</span><span class="token number">2</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> sklearn
<span class="token keyword">print</span><span class="token punctuation">(</span>sklearn<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre>
<ul>
<li>층화추출(Stratfied Sampling)</li>
<li>random_state : 실험 실행을 할 때마다 데이터셋이 계속 섞이는 것을 방지</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

<span class="token comment" spellcheck="true"># X_train -> 훈련데이터 X_val -> 검증데이터 test_size -> 훈련:검증을 7:3으로</span>
X_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">,</span> stratify <span class="token operator">=</span> X<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Pclass'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> X_val<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> y_val<span class="token punctuation">.</span>shape
</code></pre>
<ul>
<li>Base Model<ul>
<li>가장 심플한 모델</li>
</ul>
</li>
<li>평가지표<ul>
<li>분류모형 (정확도)</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score
<span class="token keyword">def</span> <span class="token function">acc_score</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> accuracy_score<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> <span class="token punctuation">(</span>y_pred <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre>
<ul>
<li>모형 학습, 예측, 예측모형의 평가</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> tree
<span class="token comment" spellcheck="true"># DecisionTreeClassifier라는 모형</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token comment" spellcheck="true"># roc_curve, roc_auc_score -> 모형 평가에 관한 내용</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve<span class="token punctuation">,</span> roc_auc_score
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment" spellcheck="true"># 모형을 만드는건 위의 2줄이 끝임</span>
tree_model <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
tree_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 예측</span>
predictions <span class="token operator">=</span> tree_model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 실제 값과 예측 값과 비교(평가)</span>
AUC <span class="token operator">=</span> roc_auc_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> predictions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ACC <span class="token operator">=</span> acc_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> predictions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># AUC : 신뢰성, ACC 얼마나 잘 맞췄느냐</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model AUC:"</span><span class="token punctuation">,</span> AUC<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model Accurarcy:"</span><span class="token punctuation">,</span> ACC<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>

fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> predictions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">,</span> 
        y <span class="token operator">=</span> <span class="token number">0.4</span><span class="token punctuation">,</span> 
        s <span class="token operator">=</span> <span class="token string">"Model AUC is &amp;#123;&amp;#125;\n\nModel Accuracy is &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>AUC<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>ACC<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> bbox<span class="token operator">=</span>dict<span class="token punctuation">(</span>facecolor<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'FPR'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'TPR'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'ROC curve'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="Helper-Class-생성"><a href="#Helper-Class-생성" class="headerlink" title="Helper Class 생성"></a>Helper Class 생성</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> tree
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve<span class="token punctuation">,</span> roc_auc_score<span class="token punctuation">,</span> accuracy_score<span class="token punctuation">,</span> confusion_matrix
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

SEED <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true"># for Reproducibility</span>

<span class="token comment" spellcheck="true"># class </span>
<span class="token keyword">class</span> <span class="token class-name">sk_helper</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> seed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;):</span>
        params<span class="token punctuation">[</span><span class="token string">'random_state'</span><span class="token punctuation">]</span> <span class="token operator">=</span> seed
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> str<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
        
    <span class="token comment" spellcheck="true"># train</span>
    <span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
        
    <span class="token comment" spellcheck="true"># predict</span>
    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>y_val<span class="token punctuation">)</span>
    
    <span class="token comment" spellcheck="true"># inner fit</span>
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    
    <span class="token comment" spellcheck="true"># feature importance</span>
    <span class="token keyword">def</span> <span class="token function">feature_importances</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span><span class="token punctuation">.</span>feature_importances_
        
    <span class="token comment" spellcheck="true"># roc_curve</span>
    <span class="token keyword">def</span> <span class="token function">roc_curve_graph</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"model_name:"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>model_name<span class="token punctuation">)</span>
        model_name <span class="token operator">=</span> self<span class="token punctuation">.</span>model_name
        preds_proba <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>
        preds <span class="token operator">=</span> <span class="token punctuation">(</span>preds_proba<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span>
        auc <span class="token operator">=</span> roc_auc_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> preds_proba<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        acc <span class="token operator">=</span> accuracy_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> preds<span class="token punctuation">)</span>
        confusion <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> preds<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Confusion Matrix'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>confusion<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model AUC: &amp;#123;0:.3f&amp;#125;, Model Accuracy: &amp;#123;1:.3f&amp;#125;\n"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>auc<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">)</span>
        fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> predictions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">,</span> 
                y <span class="token operator">=</span> <span class="token number">0.4</span><span class="token punctuation">,</span> 
                s <span class="token operator">=</span> <span class="token string">"Model AUC is &amp;#123;&amp;#125;\n\nModel Accuracy is &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>auc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>round<span class="token punctuation">(</span>acc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> bbox<span class="token operator">=</span>dict<span class="token punctuation">(</span>facecolor<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'FPR'</span><span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'TPR'</span><span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'ROC curve of &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

        plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>time
tree_params <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'max_depth': 6&amp;#125; # 하이퍼 파라미터 개념</span>

tree_model <span class="token operator">=</span> sk_helper<span class="token punctuation">(</span>model<span class="token operator">=</span>DecisionTreeClassifier<span class="token punctuation">,</span> seed<span class="token operator">=</span>SEED<span class="token punctuation">,</span> params<span class="token operator">=</span>tree_params<span class="token punctuation">)</span>
tree_model<span class="token punctuation">.</span>roc_curve_graph<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>time
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier

rf_params <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    <span class="token string">'n_jobs'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
     <span class="token string">'warm_start'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> 
     <span class="token comment" spellcheck="true">#'max_features': 0.2,</span>
    <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token string">'min_samples_leaf'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">'max_features'</span> <span class="token punctuation">:</span> <span class="token string">'sqrt'</span><span class="token punctuation">,</span>
    <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>

rf_model <span class="token operator">=</span> sk_helper<span class="token punctuation">(</span>model<span class="token operator">=</span>RandomForestClassifier<span class="token punctuation">,</span> seed<span class="token operator">=</span>SEED<span class="token punctuation">,</span> params<span class="token operator">=</span>rf_params<span class="token punctuation">)</span>
rf_model<span class="token punctuation">.</span>roc_curve_graph<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>time

<span class="token keyword">import</span> lightgbm
<span class="token keyword">from</span> lightgbm <span class="token keyword">import</span> LGBMClassifier
<span class="token keyword">print</span><span class="token punctuation">(</span>lightgbm<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
lgb_params <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    <span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
    <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>

lgb_model <span class="token operator">=</span> sk_helper<span class="token punctuation">(</span>model<span class="token operator">=</span>LGBMClassifier<span class="token punctuation">,</span> seed<span class="token operator">=</span>SEED<span class="token punctuation">,</span> params<span class="token operator">=</span>lgb_params<span class="token punctuation">)</span>
lgb_model<span class="token punctuation">.</span>roc_curve_graph<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">tree_features <span class="token operator">=</span> tree_model<span class="token punctuation">.</span>feature_importances<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
rf_features <span class="token operator">=</span> rf_model<span class="token punctuation">.</span>feature_importances<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
lgb_features <span class="token operator">=</span> lgb_model<span class="token punctuation">.</span>feature_importances<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">cols <span class="token operator">=</span> X<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>values
feature_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'features': cols, </span>
                          <span class="token string">'Decision Tree'</span><span class="token punctuation">:</span> tree_features<span class="token punctuation">,</span> 
                          <span class="token string">'RandomForest'</span><span class="token punctuation">:</span> rf_features<span class="token punctuation">,</span> 
                          <span class="token string">'LightGBM'</span><span class="token punctuation">:</span> lgb_features<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;)</span>

feature_df
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span>matplotlib inline

<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sb
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

width <span class="token operator">=</span> <span class="token number">0.3</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>feature_df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">## ax[0] graph</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> ncols <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Option sharex=True</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x <span class="token operator">-</span> width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> feature_df<span class="token punctuation">[</span><span class="token string">'Decision Tree'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"#0095FF"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> width<span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x <span class="token operator">+</span> width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> feature_df<span class="token punctuation">[</span><span class="token string">'RandomForest'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"#E6C0B1"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> width<span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span>feature_df<span class="token punctuation">[</span><span class="token string">'features'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">## ax[0] legend</span>
colors <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'Decision Tree':'#0095FF', 'RandomForest':'#E6C0B1'&amp;#125; </span>
labels <span class="token operator">=</span> list<span class="token punctuation">(</span>colors<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
handles <span class="token operator">=</span> <span class="token punctuation">[</span>plt<span class="token punctuation">.</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> label <span class="token keyword">in</span> labels<span class="token punctuation">]</span>

ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span>handles<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> bbox_to_anchor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Feature Importance between Decision Tree and RandomForest"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">## ax[1] graph</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x<span class="token punctuation">,</span> feature_df<span class="token punctuation">[</span><span class="token string">'LightGBM'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"#60F09E"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span>feature_df<span class="token punctuation">[</span><span class="token string">'features'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Feature Importance of LightGBM"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">## plt manage</span>
<span class="token comment" spellcheck="true">## plt.xticks(x, feature_df['features'], rotation=90)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

version <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%d-%m-%Y %H-%M-%S"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">final_submission</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">:</span>
    final_preds <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    binarizer <span class="token operator">=</span> np<span class="token punctuation">.</span>vectorize<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token keyword">if</span> x <span class="token operator">>=</span> <span class="token punctuation">.</span><span class="token number">5</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">)</span>
    prediction_binarized <span class="token operator">=</span> binarizer<span class="token punctuation">(</span>final_preds<span class="token punctuation">)</span>
    submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>sample_submission<span class="token punctuation">,</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>prediction_binarized<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    submission<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'PassengerId'</span><span class="token punctuation">,</span> <span class="token string">'Survived'</span><span class="token punctuation">]</span>
    submission<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'Sklearn of Submit Date &amp;#123;&amp;#125; Submission.csv'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    
final_submission<span class="token punctuation">(</span>lgb_model<span class="token punctuation">,</span> test_data<span class="token punctuation">,</span> version<span class="token punctuation">)</span>
</code></pre>
<h2 id="PyCaret"><a href="#PyCaret" class="headerlink" title="PyCaret"></a>PyCaret</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># !pip uninstall scikit-learn -y</span>
!pip install pycaret<span class="token operator">==</span><span class="token number">2.2</span><span class="token punctuation">.</span><span class="token number">3</span>
</code></pre>
<h1 id="라이브러리-버전-확인"><a href="#라이브러리-버전-확인" class="headerlink" title="라이브러리 버전 확인"></a>라이브러리 버전 확인</h1><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># check version</span>
<span class="token keyword">from</span> pycaret<span class="token punctuation">.</span>utils <span class="token keyword">import</span> version
<span class="token keyword">import</span> sklearn
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pycaret version:"</span><span class="token punctuation">,</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sklearn version:"</span><span class="token punctuation">,</span> sklearn<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre>
<h1 id="데이터셋-재정리"><a href="#데이터셋-재정리" class="headerlink" title="데이터셋 재정리"></a>데이터셋 재정리</h1><pre class=" language-python"><code class="language-python">all_df_pycaret <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
all_df_pycaret<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_df_pycaret<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int64'</span><span class="token punctuation">)</span>
all_df_pycaret<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>ML 만들기 세</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pycaret<span class="token punctuation">.</span>classification <span class="token keyword">import</span> <span class="token operator">*</span>

setup<span class="token punctuation">(</span>data <span class="token operator">=</span> all_df_pycaret<span class="token punctuation">,</span> 
      target <span class="token operator">=</span> <span class="token string">'Survived'</span><span class="token punctuation">,</span> 
      fold <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
      silent <span class="token operator">=</span> <span class="token boolean">True</span>
     <span class="token punctuation">)</span>

set_config<span class="token punctuation">(</span><span class="token string">'seed'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="클래스"><a href="#클래스" class="headerlink" title="클래스"></a>클래스</h1><ul>
<li>각 개별적으로 모형 다 만들어야함</li>
<li>평가 수치도 개별적으로 뽑은 후, 하나로 합치는 작업 (코드로 구현)</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>time

best_model <span class="token operator">=</span> compare_models<span class="token punctuation">(</span>sort <span class="token operator">=</span> <span class="token string">'Accuracy'</span><span class="token punctuation">,</span> n_select <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>time
gbc_model <span class="token operator">=</span> create_model<span class="token punctuation">(</span><span class="token string">'gbc'</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>time
tuned_gbc <span class="token operator">=</span> tune_model<span class="token punctuation">(</span>gbc_model<span class="token punctuation">,</span> n_iter <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="Feature-Importance"><a href="#Feature-Importance" class="headerlink" title="Feature Importance"></a>Feature Importance</h1><pre class=" language-python"><code class="language-python">plot_model<span class="token punctuation">(</span>tuned_gbc<span class="token punctuation">,</span> plot <span class="token operator">=</span> <span class="token string">'feature_all'</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="제출"><a href="#제출" class="headerlink" title="제출"></a>제출</h1><pre class=" language-python"><code class="language-python">predictions <span class="token operator">=</span> predict_model<span class="token punctuation">(</span>tuned_gbc<span class="token punctuation">,</span> data <span class="token operator">=</span> test_data<span class="token punctuation">)</span>
predictions<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="language-python">submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>BASE_DIR <span class="token operator">+</span> <span class="token string">'sample_submission.csv'</span><span class="token punctuation">)</span>
submission<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span> <span class="token operator">=</span> predictions<span class="token punctuation">[</span><span class="token string">'Label'</span><span class="token punctuation">]</span>
submission<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'PyCaret Submission.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
submission<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/klugjo/hexo-theme-clean-blog" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2022 SiriN<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>